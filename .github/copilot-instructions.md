# ブラウザゲーム開発 - カスタムインストラクション

このドキュメントは、因数分解ゲーム（Factorization Game）プロジェクトにおける、エージェント（GitHub Copilot等）が従うべき標準的な作業手順を定義します。

## 📋 目次
- [バージョン管理](#バージョン管理)
- [プルリクエスト作成時の手順](#プルリクエスト作成時の手順)
- [コーディング規約](#コーディング規約)
- [テスト手順](#テスト手順)
- [デプロイメント](#デプロイメント)

---

## 🔢 バージョン管理

### セマンティックバージョニング（Semantic Versioning）

**必須**: すべてのプルリクエストでは、セマンティックバージョニング（SemVer 2.0.0）に従ってバージョンを更新すること。

#### バージョン番号の形式
```
MAJOR.MINOR.PATCH
例: 1.2.3
```

#### バージョンの更新ルール

1. **MAJOR版（メジャーバージョン）** - 互換性のない変更を行った場合
   - ゲームルールの根本的な変更
   - APIの破壊的変更
   - 既存の保存データとの互換性がなくなる変更
   - 例: `1.2.3` → `2.0.0`

2. **MINOR版（マイナーバージョン）** - 後方互換性のある機能追加
   - 新機能の追加（新しいゲームモード、新しいパラメータなど）
   - 既存機能の拡張
   - 新しいUIコンポーネントの追加
   - 例: `1.2.3` → `1.3.0`

3. **PATCH版（パッチバージョン）** - 後方互換性のあるバグ修正
   - バグ修正
   - パフォーマンス改善
   - リファクタリング（機能変更なし）
   - ドキュメント更新のみ
   - 例: `1.2.3` → `1.2.4`

#### バージョン更新の実施方法

プルリクエスト作成時に、以下のファイルを必ず更新すること：

1. **`package.json`** - `version`フィールドを更新
   ```json
   {
     "version": "1.2.3"
   }
   ```

2. **`CHANGELOG.md`** - 変更内容を記録（存在する場合）
   ```markdown
   ## [1.2.3] - 2026-02-04
   ### Fixed
   - タイル移動時のバグを修正
   ```

### バージョン表示要件

**必須**: アプリケーション画面には、必ず現在のバージョンを表示すること。

#### 表示場所
- ゲーム画面のフッター
- 設定画面
- About/情報画面

#### 表示形式
```
v1.2.3
または
バージョン: 1.2.3
Version 1.2.3
```

#### 実装方法
1. `package.json`から動的にバージョンを読み込む
2. ビルド時にバージョン情報を埋め込む
3. UIコンポーネントにバージョン表示を追加

例（React）:
```tsx
import packageJson from '../package.json';

function Footer() {
  return (
    <footer>
      <span>v{packageJson.version}</span>
    </footer>
  );
}
```

---

## 📝 プルリクエスト作成時の手順

### 1. ブランチ命名規則
```
feature/機能名          # 新機能追加
bugfix/バグ名           # バグ修正
hotfix/緊急修正名       # 緊急修正
refactor/リファクタ名   # リファクタリング
docs/ドキュメント名     # ドキュメント更新
```

### 2. PR作成前のチェックリスト

- [ ] **バージョン番号を更新**（`package.json`）
- [ ] コードがリント（ESLint）を通過している
- [ ] すべてのテストが成功している
- [ ] ビルドが成功している
- [ ] バージョン表示が正しく動作している
- [ ] ブラウザでの動作確認完了（Chrome, Firefox, Safari, Edge）
- [ ] モバイルデバイスでの動作確認完了（レスポンシブ対応）
- [ ] 変更内容をREADME.mdまたはCHANGELOG.mdに記載

### 3. PRテンプレート

```markdown
## 変更内容
<!-- 変更内容を簡潔に記述 -->

## バージョン変更
- [ ] MAJOR: X.0.0 - 破壊的変更
- [ ] MINOR: X.Y.0 - 新機能追加
- [ ] PATCH: X.Y.Z - バグ修正

変更後のバージョン: `X.Y.Z`

## テスト実施状況
- [ ] ユニットテスト実施
- [ ] ブラウザ動作テスト実施
- [ ] モバイル動作テスト実施
- [ ] パフォーマンステスト実施（必要に応じて）

## スクリーンショット
<!-- UIに変更がある場合は、スクリーンショットを添付 -->

## 関連Issue
<!-- 関連するIssue番号を記載 -->
Closes #123
```

---

## 💻 コーディング規約

### TypeScript/JavaScript

1. **TypeScript strictモード** を使用
   ```json
   {
     "compilerOptions": {
       "strict": true
     }
   }
   ```

2. **ESLint** に準拠
   - セミコロンを使用
   - シングルクォート優先
   - インデントは2スペース

3. **命名規則**
   - 変数・関数: camelCase (`moveCount`, `handleClick`)
   - コンポーネント: PascalCase (`GameBoard`, `TileComponent`)
   - 定数: UPPER_SNAKE_CASE (`MAX_BOARD_SIZE`, `DEFAULT_TILE_COUNT`)

4. **コメント**
   - 複雑なロジックには日本語でコメントを追加
   - 数学的なアルゴリズムには説明を記載

### React

1. **関数コンポーネント** を使用（クラスコンポーネント不可）
2. **Hooks** を活用（useState, useEffect, useCallback, useMemo等）
3. **Propsの型定義** を必ず行う
4. **keyプロパティ** を適切に設定

---

## 🧪 テスト手順

### ブラウザゲーム標準テスト手順

#### 1. ユニットテスト
- すべての新機能にはユニットテストを追加
- バグ修正には回帰テストを追加
- カバレッジ70%以上を目標

#### 2. ブラウザ互換性テスト

**対象ブラウザ**（最新版およびその1つ前のバージョン）:
- Google Chrome
- Mozilla Firefox
- Safari（macOS/iOS）
- Microsoft Edge

**テスト項目**:
- [ ] ゲーム起動・初期表示
- [ ] タイル操作（スワイプ・クリック）
- [ ] タイル合体・消滅アニメーション
- [ ] スコア計算・表示
- [ ] パラメータ変更機能
- [ ] リセット機能
- [ ] レスポンシブデザイン（各画面サイズ）

#### 3. デバイステスト

**デスクトップ**:
- [ ] マウス操作
- [ ] キーボード操作（あれば）
- [ ] 各解像度（1920x1080, 1366x768, 1280x720）

**モバイル**:
- [ ] タッチ操作（タップ・スワイプ）
- [ ] 縦向き・横向き表示
- [ ] iOS Safari
- [ ] Android Chrome
- [ ] 各画面サイズ（iPhone, iPad, Android各種）

#### 4. パフォーマンステスト

- [ ] ゲーム起動時間（3秒以内）
- [ ] アニメーション滑らかさ（60fps維持）
- [ ] メモリ使用量（メモリリーク確認）
- [ ] 長時間プレイ（30分以上）での動作確認

#### 5. エッジケーステスト

- [ ] 盤面満杯状態
- [ ] 連鎖が大量発生
- [ ] 極端なパラメータ設定（最小・最大値）
- [ ] ネットワーク切断時の動作
- [ ] ブラウザのリロード・戻る操作

#### 6. アクセシビリティテスト

- [ ] キーボードナビゲーション
- [ ] スクリーンリーダー対応
- [ ] コントラスト比（WCAG 2.1 AA準拠）
- [ ] フォントサイズ変更への対応

### テスト実行コマンド

```bash
# ユニットテストの実行
npm test

# カバレッジレポート生成
npm run test:coverage

# リント実行
npm run lint

# ビルド
npm run build

# 開発サーバー起動
npm run dev
```

### テスト失敗時の対応

1. エラーログを確認
2. 再現手順を記録
3. Issueを作成（テンプレートに従う）
4. 修正後は回帰テストを追加

---

## 🚀 デプロイメント

### GitHub Pagesへのデプロイ

本プロジェクトはGitHub Pagesを使用してデプロイされます。

#### 自動デプロイ
- **トリガー**: `main`ブランチへのマージ
- **方法**: GitHub Actions
- **URL**: https://tanashou1.github.io/factorization-game/

#### デプロイ前チェックリスト
- [ ] バージョン番号が正しく更新されている
- [ ] すべてのテストが成功
- [ ] ビルドが成功
- [ ] バージョン表示が画面に表示される
- [ ] CHANGELOG.mdが更新されている（存在する場合）

#### デプロイ後確認
- [ ] 本番URLでゲームが正常に動作
- [ ] バージョン番号が正しく表示
- [ ] すべての機能が動作
- [ ] モバイルデバイスでの動作確認

---

## 📌 重要な注意事項

### セキュリティ
- 機密情報をコミットしない
- API キーは環境変数で管理
- 依存関係の脆弱性を定期的にチェック（`npm audit`）

### パフォーマンス
- 画像は最適化（WebP形式推奨）
- バンドルサイズを最小化
- 遅延ロード（Lazy Loading）を活用
- キャッシュ戦略を適切に設定

### ドキュメント
- README.mdは常に最新の状態を維持
- コードコメントは日本語で記述
- APIドキュメントは英語と日本語の両方で提供

---

## 🔄 継続的改善

このガイドラインは以下のタイミングで見直しを行う：
- 新しいツール・技術の導入時
- プロジェクトの規模拡大時
- チームメンバーからのフィードバック時
- 四半期ごとの定期レビュー

---

## 📚 参考資料

- [Semantic Versioning 2.0.0](https://semver.org/)
- [React Best Practices](https://react.dev/learn)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [Web Content Accessibility Guidelines (WCAG) 2.1](https://www.w3.org/WAI/WCAG21/quickref/)
- [GitHub Pages Documentation](https://docs.github.com/pages)

---

**最終更新日**: 2026-02-04
**バージョン**: 1.0.0
