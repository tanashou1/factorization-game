# ブラウザゲーム テスト手順ガイド

因数分解ゲーム（Factorization Game）の包括的なテスト手順を定義します。

## 📋 目次
- [テストの種類](#テストの種類)
- [テスト環境](#テスト環境)
- [テストチェックリスト](#テストチェックリスト)
- [テストツール](#テストツール)
- [テスト報告](#テスト報告)

---

## 🧪 テストの種類

### 1. ユニットテスト
**目的**: 個別の関数やコンポーネントが正しく動作することを確認

**実施タイミング**: 
- 新機能追加時
- バグ修正時
- リファクタリング後

**カバレッジ目標**: 70%以上

**テスト対象**:
- ゲームロジック関数
  - 素因数分解関数
  - 約数判定関数
  - タイル移動ロジック
  - スコア計算ロジック
  - 連鎖判定ロジック
- ユーティリティ関数
- 状態管理ロジック

### 2. 統合テスト
**目的**: 複数のコンポーネントが連携して正しく動作することを確認

**テスト対象**:
- ゲームフロー全体
- コンポーネント間の連携
- 状態管理とUIの同期

### 3. E2Eテスト（エンドツーエンドテスト）
**目的**: ユーザーの実際の操作フローを再現してテスト

**テストシナリオ**:
1. ゲーム起動から終了まで
2. パラメータ変更とリセット
3. 長時間プレイ（30分以上）
4. スコア記録と表示

---

## 💻 テスト環境

### 対象ブラウザ

#### デスクトップ
| ブラウザ | バージョン | OS |
|---------|----------|-----|
| Google Chrome | 最新版、1つ前 | Windows, macOS, Linux |
| Mozilla Firefox | 最新版、1つ前 | Windows, macOS, Linux |
| Safari | 最新版、1つ前 | macOS |
| Microsoft Edge | 最新版、1つ前 | Windows, macOS |

#### モバイル
| ブラウザ | バージョン | OS |
|---------|----------|-----|
| Safari | 最新版 | iOS 16以降 |
| Chrome | 最新版 | Android 10以降 |
| Samsung Internet | 最新版 | Android |

### 対象デバイス

#### デスクトップ解像度
- 1920x1080 (Full HD)
- 1366x768 (HD)
- 1280x720 (HD Ready)
- 2560x1440 (2K)
- 3840x2160 (4K)

#### モバイルデバイス
- **iPhone**: iPhone 12以降、iPhone SE
- **iPad**: iPad Air、iPad Pro
- **Android**: Samsung Galaxy S21以降、Google Pixel

---

## ✅ テストチェックリスト

### 基本機能テスト

#### ゲーム起動
- [ ] ページが3秒以内に読み込まれる
- [ ] 初期画面が正しく表示される
- [ ] バージョン番号が表示される
- [ ] デフォルトパラメータが正しく設定されている
- [ ] 初期タイルが正しく配置されている

#### タイル操作
- [ ] タイルをタップ/クリックして選択できる
- [ ] スワイプでタイルが移動する
- [ ] 4方向（上下左右）への移動が可能
- [ ] タイル移動アニメーションが滑らか（60fps）
- [ ] 移動中は他の操作ができない（誤操作防止）
- [ ] 移動できない方向では動かない

#### タイル合体
- [ ] 約数関係にあるタイルが正しく合体する
- [ ] 合体時のアニメーションが表示される
- [ ] 合体後の値が正しく計算される
- [ ] 同じ値のタイルが消滅する
- [ ] 完全累乗（平方数・立方数）で特殊エフェクトが表示される

#### 連鎖
- [ ] 連鎖が正しく発生する
- [ ] 連鎖回数が表示される
- [ ] 連鎖によるスコア倍率が正しく計算される
- [ ] 連鎖アニメーションが表示される

#### スコア
- [ ] スコアが正しく計算される
- [ ] スコアがリアルタイムで更新される
- [ ] 連鎖ボーナスが正しく適用される
- [ ] スコア表示が見やすい

#### パラメータ設定
- [ ] ボードサイズ(n)が変更できる（3～8）
- [ ] 初期タイル数(m)が変更できる（1～10）
- [ ] 新タイル出現間隔(k)が変更できる（1～10）
- [ ] 最大素数(p)が変更できる（2～19）
- [ ] パラメータ変更が即座に反映される
- [ ] 無効な値は入力できない

#### リセット機能
- [ ] リセットボタンが機能する
- [ ] ゲーム状態が初期化される
- [ ] パラメータが保持される
- [ ] スコアがリセットされる

#### タイル生成
- [ ] k回移動後に新タイルが出現する
- [ ] タイル消滅時に新タイルが出現する
- [ ] 手動生成ボタンが機能する
- [ ] 生成されるタイルの値が適切（素数の積）
- [ ] 空きマスにのみ生成される

### UI/UXテスト

#### レスポンシブデザイン
- [ ] デスクトップ表示が適切
- [ ] タブレット表示が適切
- [ ] モバイル表示が適切
- [ ] 縦向き・横向きの両方で表示が適切
- [ ] 各要素が画面からはみ出さない
- [ ] テキストが読みやすい

#### アクセシビリティ
- [ ] キーボードでナビゲーションできる
- [ ] フォーカス表示が明確
- [ ] カラーコントラストがWCAG AA基準を満たす
- [ ] テキストサイズが調整可能
- [ ] タッチターゲットが十分な大きさ（44x44px以上）

#### アニメーション
- [ ] すべてのアニメーションが滑らか
- [ ] アニメーション速度が適切
- [ ] アニメーション中の誤操作防止
- [ ] モーション削減設定に対応

### パフォーマンステスト

#### 起動時間
- [ ] 初回読み込み：3秒以内
- [ ] 2回目以降：1秒以内（キャッシュ有効）

#### レスポンス時間
- [ ] タイル移動：即座（<100ms）
- [ ] 合体処理：即座（<200ms）
- [ ] パラメータ変更：即座（<100ms）

#### フレームレート
- [ ] アニメーション中：60fps維持
- [ ] 連鎖発生時：60fps維持
- [ ] 盤面満杯時：60fps維持

#### メモリ
- [ ] メモリ使用量が安定
- [ ] メモリリークがない（30分以上のプレイ）
- [ ] ブラウザタブを複数開いても動作する

### エッジケーステスト

#### 極端な状況
- [ ] 盤面が満杯の状態
- [ ] 連鎖が10回以上発生
- [ ] スコアが100万を超える
- [ ] パラメータが最小値（n=3, m=1, k=1, p=2）
- [ ] パラメータが最大値（n=8, m=10, k=10, p=19）

#### エラーハンドリング
- [ ] ネットワーク切断時の動作
- [ ] ブラウザのリロード
- [ ] ブラウザの戻る・進む操作
- [ ] タブの切り替え
- [ ] ブラウザの最小化・復帰

#### データ永続性
- [ ] ゲーム状態が保存される（あれば）
- [ ] 設定が保存される（あれば）
- [ ] リロード後も状態が復元される（あれば）

---

## 🛠️ テストツール

### 推奨ツール

#### ユニットテスト
```bash
# Jest（推奨）
npm install --save-dev jest @types/jest

# React Testing Library（React使用時）
npm install --save-dev @testing-library/react @testing-library/jest-dom
```

#### E2Eテスト
```bash
# Playwright（推奨）
npm install --save-dev @playwright/test

# または Cypress
npm install --save-dev cypress
```

#### リント・フォーマット
```bash
# ESLint
npm install --save-dev eslint

# Prettier
npm install --save-dev prettier
```

#### パフォーマンス測定
- Chrome DevTools（Lighthouse）
- WebPageTest
- Google PageSpeed Insights

#### アクセシビリティ
- axe DevTools
- WAVE（Web Accessibility Evaluation Tool）
- Chrome DevTools（Lighthouse）

---

## 📊 テスト報告

### テスト結果の記録

テスト実施後は、以下の情報を記録します：

```markdown
## テスト報告

**テスト日時**: 2026-02-04 15:30
**テスター**: [名前]
**バージョン**: v1.2.3
**ブランチ**: feature/new-game-mode

### 環境
- OS: macOS 14.0
- ブラウザ: Chrome 120.0
- デバイス: MacBook Pro 16inch

### テスト結果
- ユニットテスト: ✅ 全テスト成功（カバレッジ 75%）
- ブラウザテスト: ✅ 全ブラウザで動作確認
- パフォーマンステスト: ✅ 基準を満たす
- アクセシビリティ: ⚠️ 一部改善が必要

### 発見された問題
1. [BUG] Safari 17でアニメーションがカクつく
2. [WARNING] モバイルでのタッチ判定が狭い

### 推奨事項
- Safariのアニメーション最適化が必要
- タッチターゲットサイズを48pxに拡大
```

### テスト失敗時の対応

1. **Issue作成**: バグレポートテンプレートを使用
2. **再現手順の記録**: 詳細な手順を記載
3. **スクリーンショット**: エラー画面を添付
4. **環境情報**: ブラウザ、OS、バージョンを記載
5. **優先度設定**: クリティカル、高、中、低

---

## 🔄 継続的インテグレーション（CI）

### GitHub Actionsでの自動テスト

```yaml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm ci
      - name: Run linter
        run: npm run lint
      - name: Run tests
        run: npm test
      - name: Build
        run: npm run build
```

---

## 📚 参考資料

- [Jest Documentation](https://jestjs.io/)
- [React Testing Library](https://testing-library.com/react)
- [Playwright Documentation](https://playwright.dev/)
- [Web Content Accessibility Guidelines (WCAG) 2.1](https://www.w3.org/WAI/WCAG21/quickref/)
- [Chrome DevTools](https://developer.chrome.com/docs/devtools/)

---

**最終更新日**: 2026-02-04
**バージョン**: 1.0.0
