# 因数分解ゲーム (Factorization Game)

**Play the game here: https://tanashou1.github.io/factorization-game/**

素因数分解をベースにした数字パズルゲームです。タイルを動かして約数で割り、連鎖させてスコアを競います。

## 📝 ゲーム概要

n×nマスの盤面上で、数字タイルをスライドさせて操作するパズルゲームです。タイル同士が約数関係にあるとき、合体して割り算が実行されます。タイルの値が1になると消滅し、スコアを獲得できます。連鎖反応を活用して高得点を目指しましょう。

## 🎮 基本ルール

### タイルの移動
- **タッチ操作**: スワイプで特定のタイル、または全タイルを動かす
  - タイルに触れてスワイプ: そのタイルのみが移動
  - 空きマスに触れてスワイプ: すべてのタイルが同時移動

### タイルの合体ルール

#### 1. 基本的な合体（約数による割り算）
片方のタイルがもう片方の約数である場合、合体が発生します：
- **約数タイル（小）**: 消滅
- **被約数タイル（大）**: 割り算の結果（大 ÷ 小）に変化
- **結果の位置**: 大きい方のタイルがあった場所

**例**: タイル「3」とタイル「147」が隣接
- 3は147の約数（147 ÷ 3 = 49）
- タイル「3」が消滅
- タイル「147」が「49」に変化

#### 2. 同じ値での消滅
同じ値のタイルが隣接すると、両方とも消滅します：
- 両タイルが消滅
- それぞれの値がスコアに加算

**例**: 「7」と「7」が隣接 → 両方消滅、スコア +14

#### 3. 完全累乗での特殊消滅
同じ値のタイルが完全累乗（平方数または立方数）の場合、特殊なアニメーションとともに消滅します：
- **平方数**: 4, 9, 16, 25, 36, 49, 64, 81, 100...（n²の形）
- **立方数**: 8, 27, 64, 125, 216...（n³の形）

**例**: 「49」と「49」が隣接（49 = 7²）→ 特殊なタイル消滅エフェクト

### 連鎖反応
合体後、自動的に隣接タイルとの約数関係をチェックし、連続して合体が発生します：
1. 小さい値のタイルから順に処理
2. 隣接タイルとの約数関係を確認
3. 合体可能な組み合わせがある限り繰り返し
4. 連鎖回数に応じてスコア倍率が上昇（2^n倍）

**連鎖の例**:
```
初期状態: [2] [3] [6]
↓
1回目: 2と6が合体 → [3] [3]
↓
2回目: 3と3が消滅 → []（全消滅）
```

### タイルの消滅
以下の条件でタイルが消滅します：
- 値が1になった時
- 同じ値のタイル同士が隣接した時
- 合体で約数側のタイルになった時

### スコアリング
- タイルが変化する際、そのタイルの元の値がスコアに加算
- 連鎖が発生すると、連鎖回数に応じてスコアが倍増：
  - 1連鎖目: 1倍
  - 2連鎖目: 2倍
  - 3連鎖目: 4倍
  - n連鎖目: 2^(n-1)倍

### 新しいタイルの出現
以下の条件で新しいタイルが出現します：
- k回移動した時（kはパラメータ設定可能）
- タイルが消滅した時
- 「タイル生成」ボタンを押した時（手動生成）

## ⚙️ ゲームパラメータ

ゲーム画面下部で以下のパラメータを調整できます：

| パラメータ | 記号 | 説明 | デフォルト値 | 範囲 |
|----------|------|------|------------|------|
| ボードサイズ | n | 盤面のサイズ（n×nマス） | 4 | 3～8 |
| 初期タイル数 | m | ゲーム開始時のタイル数 | 2 | 1～10 |
| 新タイル出現間隔 | k | k回移動ごとに新タイルが出現 | 3 | 1～10 |
| 最大素数 | p | タイル生成に使う素数の最大値 | 7 | 2～19 |

### タイルの数値生成ルール
- p以下の素数をリストアップ（例: p=7 → [2, 3, 5, 7]）
- ランダムに1～p以下の素数の個数個の素数を選択（例 p=7なら、4個。数の重複を許す）
- それらの積を新タイルの値とする

**例**: p=7の場合
- 2 × 3 = 6
- 5 × 7 = 35
- 2 × 2 × 3 = 12
など多様なタイルが生成される

## 🎨 ゲームの特徴

### アニメーション効果
- **タイル出現**: フェードインアニメーション
- **タイル移動**: スムーズなスライドアニメーション
- **合体・消滅**: ハイライト表示後、消滅アニメーション
- **完全累乗消滅**: 平方数・立方数の特殊エフェクト
- **連鎖カウンター**: 連鎖回数の表示

### 操作性
- タッチデバイスでの直感的な操作
- アニメーション中の誤操作防止
- 個別タイル移動と全体移動の使い分け

### バランス調整
- パラメータの変更による調整
- リセットボタンで設定反映

## 🎯 ゲーム攻略のヒント

### 基本戦略
1. **小さい数を活用**: 2、3、5などの小さい素数タイルは、多くのタイルと合体可能
2. **連鎖を狙う**: 連鎖が発生するとスコアが倍増（2のべき乗倍）
3. **同じ値を隣接**: 同じ値のタイルを隣接させると両方消滅してスコア獲得
4. **完全累乗を意識**: 平方数（4, 9, 16, 25...）のペアは特殊消滅

### 高スコアのコツ
- **連鎖の最大化**: 一度の移動で複数回連鎖させるほど高スコア
- **複数タイル因数分解**: 3つ以上のタイルを同時に因数分解できる配置を作る
- **盤面管理**: タイルを詰めすぎず、連鎖の余地を残す
- **計画的な移動**: 次に出現するタイルのためのスペースを確保

### パラメータ調整のコツ
- **初心者向け**: n=4, m=2, k=5, p=5（少ないタイル、小さい数値）
- **標準**: n=4, m=2, k=3, p=7（デフォルト設定）
- **上級者向け**: n=5, m=3, k=2, p=11（多いタイル、大きい数値、速いペース）
- **カオスモード**: n=6, m=5, k=1, p=19（最大難易度）

## 📚 参考情報

### 数学的背景
このゲームは以下の数学的概念を活用しています：
- **素因数分解**: すべての自然数は素数の積で一意に表現できる
- **約数**: ある数を割り切れる数（例: 6の約数は1, 2, 3, 6）
- **完全累乗**: n²（平方数）やn³（立方数）の形の数
- **エラトステネスの篩**: 素数を効率的に列挙するアルゴリズム

## 🔧 技術仕様

### タイル処理フロー
1. **移動フェーズ**
   - ユーザー入力
   - タイルの移動方向決定
   - 移動完了

2. **反応フェーズ**
   - 移動したタイルについて、隣接するタイルと反応するか計算
   - エフェクトを出しながら、タイルの反応処理
  
3. **連鎖フェーズ**
   - 反応がなくなるまで、2を繰り返し。
   - 前の2で数値が変化したタイルが再度反応する場合、連鎖判定

4. **タイル生成**
   - 新タイル生成の判定

### コーディング規約
- TypeScript strictモードを使用
- Reactの関数コンポーネントとHooksを使用
- ESLintルールに準拠
- すべての新機能にテストを追加
- バグ修正には回帰テストを追加

### デプロイ
本プロジェクトはGitHub Pagesにデプロイします。
- メインブランチへのプッシュで自動デプロイ（GitHub Actions）
- デプロイURL: https://tanashou1.github.io/factorization-game/

## 🤝 貢献

プロジェクトへの貢献を歓迎します！詳細は以下のドキュメントを参照してください：

- **[CONTRIBUTING.md](CONTRIBUTING.md)** - 貢献ガイド
- **[.github/copilot-instructions.md](.github/copilot-instructions.md)** - エージェント向けカスタムインストラクション
- **[TESTING.md](TESTING.md)** - テスト手順ガイド
- **[CHANGELOG.md](CHANGELOG.md)** - 変更履歴

### 重要なルール

1. **セマンティックバージョニング**: すべてのPRでバージョンを更新してください
2. **バージョン表示**: アプリ画面にバージョンを表示してください
3. **テスト**: 変更前に必ずテストを実施してください

### バージョン情報

現在のバージョン: **v1.0.0**

